---
title: DB設計書（全体インデックス）
project: "<プロジェクト名>"
version: "v0.2"
last_updated: "YYYY-MM-DD"
---

# 1. 概要
本ドキュメントは、プロジェクト全体のデータベース設計のインデックス、および共通の設計方針を定義する。
詳細なデータモデルは、各ドメイン定義書を参照すること。

# 2. ドメイン構成一覧
以下にプロジェクトのドメイン構成を記載する。

| No | ドメイン名 | ファイルリンク | 概要 |
|---|---|---|---|
| 1 | (Example) | [00_domain_template.md](./domains/00_domain_template.md) | (ドメインの説明) |
| 2 | ... | ... | ... |

# 3. テクノロジースタック
プロジェクトで使用するデータベースおよび関連技術を選定・記載すること。

| 役割 | 技術 | バージョン | 用途 |
|---|---|---|---|
| **メインDB** | (例: PostgreSQL, MySQL) | x.x | メイントランザクションデータ |
| **NoSQL / キャッシュ** | (例: Redis, DynamoDB) | x.x | セッション管理, 高頻度アクセスデータ |
| **検索エンジン** | (例: Elasticsearch) | x.x | 全文検索, ログ分析 |
| **マイグレーションツール** | (例: Flyway, Prisma) | - | スキーマ管理 |

# 4. 共通設計方針

## 4.1 命名規則
一貫性を保つためのルールを定義する。以下は推奨例である。

*   **RDBMS (SQL)**
    *   テーブル: `snake_case` (複数形) 例: `users`, `order_items`
    *   カラム: `snake_case` 例: `user_id`, `created_at`
*   **NoSQL (ドキュメント)**
    *   コレクション: `camelCase` または `snake_case`
    *   フィールド: `camelCase` (JSON標準) 例: `userId`, `createdAt`

## 4.2 ID設計
使用するID生成戦略を明確にすること。

*   **サロゲートキー**: `AUTO_INCREMENT` / `SERIAL` (BIGINT)
*   **分散ID**: UUID (v4/v7), ULID, Snowflake, NanoID
*   **ナチュラルキー**: 業務コードをPKとする場合（基本は非推奨）

## 4.3 監査・共通カラム
全テーブル/ドキュメントに付与すべき共通フィールド。

| 項目 | SQL例 | NoSQL例 | 必須 | 備考 |
|---|---|---|---|---|
| 作成日時 | `created_at` | `createdAt` | Yes | - |
| 更新日時 | `updated_at` | `updatedAt` | Yes | - |
| 作成者 | `created_by` | `createdBy` | Option | システムUser IDなど |
| 更新者 | `updated_by` | `updatedBy` | Option | - |
| バージョン | `lock_version` | `version` | Option | 楽観ロック用 |

## 4.4 文字コード・タイムゾーン
*   **文字セット**: `UTF-8` (utf8mb4) を基本とする。
*   **照合順序 (Collation)**: `utf8mb4_0900_ai_ci` (MySQL 8.0+) 等、要件に合わせて定義。
*   **タイムゾーン**: 原則 `UTC` で保存し、アプリケーション層でJST等へ変換することを推奨。

# 5. セキュリティ・アクセス制御
*   **接続ユーザー権限**: アプリケーション用ユーザーには必要最小限の権限（CRUDのみ、DDL不可など）を付与する。
*   **行レベルセキュリティ (RLS)**: マルチテナント要件がある場合、RLSの採用を検討する。
*   **暗号化**: 機密情報（パスワード、PII）はアプリケーション側で暗号化、またはDBの透過的暗号化機能を利用する。

# 6. バックアップ・保守
*   **バックアップ頻度**: (例: 日次フルバックアップ + WALアーカイブ)
*   **保持期間**: (例: 30日間)
*   **削除方針**:
    *   物理削除: 個人情報などで完全削除が必要な場合。
    *   論理削除: `deleted_at` カラム等の利用。一意制約との兼ね合いに注意。

