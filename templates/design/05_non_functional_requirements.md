---
title: 非機能要件定義書（テンプレート）
project: "<プロジェクト名>"
version: "v0.1"
last_updated: "YYYY-MM-DD"
---

# 1. 性能要件 (Performance)
## 1.1 レスポンスタイム
- 画面表示: **2秒以内** (90% tile)
- API応答: **500ms以内** (平均)
- バッチ処理: 指定時間内に終了すること

## 1.2 スループット (負荷想定)
- 通常時: 100 req/sec
- ピーク時: 500 req/sec (キャンペーン時などを想定)
- 同時接続数: 1,000 users

# 2. 可用性 (Availability)
## 2.1 稼働率目標
- **目標稼働率 (SLA)**: 99.9% (月間停止時間 43分以内)
- **メンテナンス**: 深夜帯 (02:00-04:00) に計画停止を許容するか？ -> 原則無停止 (Blue/Greenデプロイ等)

## 2.2 冗長構成
- **アプリケーションサーバー**: 複数AZ構成（最低2台）
- **データベース**: プライマリ/スタンバイ構成（レプリケーション有効）
- **ロードバランサー**: ALB/NLB による自動振り分け

## 2.3 障害時の挙動
- サーバー障害時: 自動的にヘルスチェックで検知し、トラフィックを振り分け
- DB障害時: 自動フェイルオーバー（目標: 60秒以内）

# 3. スケーラビリティ (Scalability)
## 3.1 垂直スケーリング (Scale Up)
- サーバースペック上限: CPU 16vCPU, Memory 64GB まで対応
- 必要に応じてインスタンスタイプを変更

## 3.2 水平スケーリング (Scale Out)
- **自動スケーリング**: CPU使用率70%超過時に自動増設
- **最小インスタンス数**: 2台（冗長化のため）
- **最大インスタンス数**: 20台
- **スケールアウト時間**: 5分以内に新インスタンス起動

## 3.3 データベーススケーリング
- **読み取りレプリカ**: 負荷に応じて追加（最大5台）
- **シャーディング**: 将来的に検討（ユーザー数100万超時）
- **キャッシュ層**: Redis でホットデータをキャッシュ

# 4. セキュリティ (Security)
## 4.1 認証・認可
- **パスワード**: ハッシュ化 (BCrypt/Argon2)、8文字以上必須
- **多要素認証**: 管理者アカウントは必須、一般ユーザーは任意
- **セッション管理**: タイムアウト 30分、リフレッシュトークン 7日

## 4.2 通信セキュリティ
- **通信**: 常時HTTPS (TLS 1.2+)
- **証明書**: Let's Encrypt または商用証明書
- **HSTS**: 有効化

## 4.3 脆弱性対策
- **OWASP Top 10 対応**: SQLi, XSS, CSRF, セキュリティ設定ミス等
- **依存パッケージ**: 定期的な脆弱性スキャン（週次）
- **ペネトレーションテスト**: 年1回実施

## 4.4 監査・コンプライアンス
- **監査ログ**: ログイン、権限変更、個人情報閲覧はログに残す
- **ログ改ざん防止**: ログは改変不可能なストレージに保存
- **アクセス制御**: 最小権限の原則に従う

# 5. 運用性 (Operability)
## 5.1 監視 (Monitoring)
### 5.1.1 監視項目
| カテゴリ | 監視項目 | 閾値 | 対応レベル |
|---|---|---|---|
| インフラ | CPU使用率 | 80%超過が5分継続 | Warning |
| インフラ | メモリ使用率 | 85%超過 | Warning |
| インフラ | ディスク使用率 | 80%超過 | Warning |
| アプリ | エラー率 | 5%超過 | Critical |
| アプリ | レスポンスタイム | 2秒超過(P95) | Warning |
| DB | コネクション数 | 上限の80% | Warning |
| DB | スロークエリ | 3秒超過 | Info |

### 5.1.2 監視ツール
- **メトリクス**: Datadog / CloudWatch / Prometheus
- **ログ**: Datadog / CloudWatch Logs / ELK Stack
- **APM**: Datadog APM / New Relic
- **外形監視**: Pingdom / UptimeRobot

## 5.2 アラート (Alerting)
### 5.2.1 通知先
| 重要度 | 通知先 | 通知方法 | 対応時間 |
|---|---|---|---|
| Critical | オンコール担当者 | 電話 + Slack + メール | 即時 |
| Warning | 開発チーム | Slack + メール | 1時間以内 |
| Info | ログのみ | - | - |

### 5.2.2 エスカレーション
- 30分対応なし → マネージャーへエスカレーション
- 1時間対応なし → 役員へエスカレーション

## 5.3 ログ管理
- **ログレベル**: ERROR, WARN, INFO, DEBUG
- **本番環境**: INFO レベル以上を記録
- **保持期間**: エラーログ 1年、アクセスログ 3ヶ月
- **個人情報**: ログに含めない（マスキング処理）

# 6. バックアップ・保守性
## 6.1 バックアップ
- **DBバックアップ**: 
  - フルバックアップ: 毎日実施、30世代保持
  - 増分バックアップ: 6時間毎
  - トランザクションログ: リアルタイム保存
- **ファイルバックアップ**: S3 バージョニング有効化
- **バックアップテスト**: 月次でリストアテスト実施

## 6.2 障害復旧 (Disaster Recovery)
### 6.2.1 復旧目標
- **RTO (目標復旧時間)**: 2時間以内
- **RPO (目標復旧時点)**: データ損失 1時間以内

### 6.2.2 DR戦略
- **バックアップ＆リストア**: 定期バックアップからの復旧
- **パイロットライト**: 最小構成を常時起動（コア機能のみ）
- **マルチリージョン**: 将来的に検討（グローバル展開時）

### 6.2.3 復旧手順
1. 障害検知・影響範囲特定（15分）
2. バックアップからDB復旧（45分）
3. アプリケーション再起動・疎通確認（30分）
4. サービス再開・監視強化（30分）

## 6.3 保守性
- **デプロイ頻度**: 週1回（緊急時は随時）
- **ロールバック**: 5分以内に前バージョンへ戻せること
- **ドキュメント**: 運用手順書、トラブルシューティングガイドを整備

# 7. コンプライアンス (Compliance)
## 7.1 法令遵守
| 法令・規制 | 対応内容 |
|---|---|
| 個人情報保護法 | 個人情報の適切な取り扱い、プライバシーポリシー公開 |
| 特定商取引法 | 販売者情報の明示、返品・交換ポリシー |
| 電子帳簿保存法 | 取引記録の電子保存（7年間） |
| GDPR | EU居住者データの保護（該当する場合） |

## 7.2 セキュリティ基準
- **ISMS**: ISO/IEC 27001 準拠を目指す
- **PCI DSS**: クレジットカード情報を扱う場合は準拠必須

## 7.3 監査対応
- **内部監査**: 半期に1回実施
- **外部監査**: 年1回実施（必要に応じて）
- **証跡保管**: 監査ログ、変更履歴を5年間保管

# 8. SLO / SLI 定義 (Service Level Objectives / Indicators)
## 8.1 SLI (サービスレベル指標)
| SLI名 | 測定方法 | 目標値 |
|---|---|---|
| 可用性 | 成功リクエスト数 / 全リクエスト数 | 99.9% |
| レスポンスタイム | P95レスポンスタイム | 2秒以内 |
| エラー率 | エラーレスポンス数 / 全リクエスト数 | 1%以内 |
| スループット | 処理可能リクエスト数 | 500 req/sec |

## 8.2 SLO (サービスレベル目標)
### 8.2.1 月次目標
- **稼働率**: 99.9%以上（月間ダウンタイム 43分以内）
- **平均応答時間**: 500ms以内
- **エラー率**: 0.5%以内

### 8.2.2 エラーバジェット
- 月間許容ダウンタイム: 43分
- エラーバジェット消費時の対応:
  - 50%消費: 新機能開発を抑制し、安定性向上に注力
  - 80%消費: 緊急対策会議、全力で安定化
  - 100%消費: 新規デプロイ凍結

## 8.3 測定・レポート
- **リアルタイムダッシュボード**: Grafana / Datadog で常時監視
- **週次レポート**: SLI達成状況をチームで共有
- **月次レビュー**: SLO達成状況を経営層に報告
